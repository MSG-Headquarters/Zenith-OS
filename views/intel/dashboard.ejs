<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTEL Marketing Engine - Zenith OS</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f1724; color: #e2e8f0; min-height: 100vh; display: flex; }

        /* ── Sidebar ── */
        .sidebar { width: 240px; background: #1a2332; display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.06); position: fixed; top: 0; bottom: 0; left: 0; z-index: 100; }
        .sidebar-header { padding: 20px 16px 16px; border-bottom: 1px solid rgba(255,255,255,0.06); }
        .sidebar-header h2 { font-size: 1.1rem; font-weight: 700; }
        .sidebar-header h2 span:first-child { color: #10b981; }
        .sidebar-header h2 span:last-child { color: #e2e8f0; }
        .sidebar-header p { color: #64748b; font-size: 0.75rem; margin-top: 2px; }
        .nav-section { padding: 12px 0; }
        .nav-section-label { color: #475569; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1.2px; padding: 0 16px 8px; font-weight: 600; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 9px 16px; color: #94a3b8; text-decoration: none; font-size: 0.85rem; transition: all 0.15s; border-left: 3px solid transparent; }
        .nav-item:hover { background: rgba(255,255,255,0.04); color: #e2e8f0; }
        .nav-item.active { background: rgba(16, 185, 129, 0.08); color: #10b981; border-left-color: #10b981; }
        .nav-icon { font-size: 1rem; width: 20px; text-align: center; }
        .sidebar-footer { margin-top: auto; padding: 16px; border-top: 1px solid rgba(255,255,255,0.06); }
        .sidebar-footer .user-info { display: flex; align-items: center; gap: 10px; }
        .sidebar-footer .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: #10b981; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600; color: #fff; }
        .sidebar-footer .user-name { font-size: 0.8rem; color: #e2e8f0; }
        .sidebar-footer .user-role { font-size: 0.65rem; color: #64748b; }
        .sidebar-footer a { color: #64748b; font-size: 0.75rem; text-decoration: none; display: block; margin-top: 8px; }
        .sidebar-footer a:hover { color: #ef4444; }

        /* ── Main Content ── */
        .main-content { flex: 1; margin-left: 240px; min-height: 100vh; }

        /* ── Top Bar ── */
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 16px 32px; border-bottom: 1px solid rgba(255,255,255,0.06); background: #1a2332; }
        .top-bar h1 { font-size: 1.35rem; font-weight: 700; }
        .top-bar h1 .accent { color: #10b981; }
        .top-bar-actions { display: flex; gap: 10px; }
        .btn { padding: 8px 16px; border-radius: 8px; font-size: 0.85rem; font-weight: 500; border: none; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; transition: all 0.15s; }
        .btn-ghost { background: transparent; color: #94a3b8; border: 1px solid rgba(255,255,255,0.1); }
        .btn-ghost:hover { background: rgba(255,255,255,0.05); color: #e2e8f0; }
        .btn-primary { background: #10b981; color: #fff; }
        .btn-primary:hover { background: #059669; }

        /* ── Sub-Tab Navigation ── */
        .intel-tabs { display: flex; gap: 4px; padding: 12px 32px 0; background: #1a2332; }
        .intel-tab { padding: 10px 20px; border-radius: 8px 8px 0 0; font-size: 0.85rem; font-weight: 500; color: #64748b; text-decoration: none; display: flex; align-items: center; gap: 8px; transition: all 0.15s; border: 1px solid transparent; border-bottom: none; position: relative; }
        .intel-tab:hover { color: #e2e8f0; background: rgba(255,255,255,0.03); }
        .intel-tab.active { color: #10b981; background: #0f1724; border-color: rgba(255,255,255,0.06); }
        .intel-tab.active::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: #10b981; }
        .intel-tab i { font-size: 1rem; }
        .intel-tab .tab-badge { background: rgba(16,185,129,0.15); color: #10b981; font-size: 0.7rem; padding: 2px 8px; border-radius: 100px; font-weight: 600; }

        /* ── Stats Grid ── */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; padding: 24px 32px; }
        .stat-card { background: #1a2332; border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.06); transition: all 0.2s; }
        .stat-card:hover { border-color: rgba(16,185,129,0.2); }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: #10b981; }
        .stat-label { font-size: 0.8rem; color: #64748b; margin-top: 4px; }

        /* ── Sub-Function Cards ── */
        .subfunc-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; padding: 0 32px 32px; }
        .subfunc-card { background: #1a2332; border-radius: 16px; padding: 32px; border: 1px solid rgba(255,255,255,0.06); transition: all 0.25s; cursor: pointer; text-decoration: none; color: inherit; display: flex; flex-direction: column; }
        .subfunc-card:hover { border-color: rgba(16,185,129,0.3); transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .subfunc-icon { width: 56px; height: 56px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 20px; }
        .subfunc-icon.research { background: rgba(59,130,246,0.12); color: #3b82f6; }
        .subfunc-icon.create { background: rgba(16,185,129,0.12); color: #10b981; }
        .subfunc-title { font-size: 1.25rem; font-weight: 700; color: #e2e8f0; margin-bottom: 8px; }
        .subfunc-desc { font-size: 0.85rem; color: #64748b; line-height: 1.6; margin-bottom: 20px; flex: 1; }
        .subfunc-features { display: flex; flex-wrap: wrap; gap: 8px; }
        .subfunc-feature { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); padding: 4px 12px; border-radius: 100px; font-size: 0.75rem; color: #94a3b8; }
        .subfunc-arrow { color: #10b981; font-size: 1.25rem; margin-top: 20px; opacity: 0; transition: all 0.2s; }
        .subfunc-card:hover .subfunc-arrow { opacity: 1; transform: translateX(4px); }

        /* ── Recent Activity ── */
        .section-header { display: flex; justify-content: space-between; align-items: center; padding: 0 32px 12px; }
        .section-title { font-size: 1rem; font-weight: 600; color: #e2e8f0; }
        .section-action { color: #10b981; font-size: 0.8rem; text-decoration: none; }
        .section-action:hover { text-decoration: underline; }
        .activity-list { padding: 0 32px 32px; }
        .activity-empty { background: #1a2332; border-radius: 12px; padding: 48px; text-align: center; border: 1px solid rgba(255,255,255,0.06); }
        .activity-empty i { font-size: 2.5rem; color: #334155; margin-bottom: 12px; }
        .activity-empty h3 { font-size: 1rem; font-weight: 600; color: #94a3b8; margin-bottom: 4px; }
        .activity-empty p { font-size: 0.85rem; color: #475569; }

        @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 900px) { .subfunc-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2><span>ZENITH</span> <span>OS</span></h2>
            <p><%= typeof tenant !== 'undefined' && tenant ? tenant.name : 'CRE Consultants' %></p>
        </div>
        <div class="nav-section">
            <div class="nav-section-label">Navigation</div>
            <a href="/dashboard" class="nav-item"><span class="nav-icon"><i class="bi bi-house"></i></span> Dashboard</a>
            <a href="/crm" class="nav-item"><span class="nav-icon"><i class="bi bi-kanban"></i></span> CRM Pipeline</a>
            <a href="/intel" class="nav-item active"><span class="nav-icon"><i class="bi bi-broadcast"></i></span> INTEL</a>
            <a href="/huddle" class="nav-item"><span class="nav-icon"><i class="bi bi-chat-dots"></i></span> Huddle</a>
            <a href="/mailer" class="nav-item"><span class="nav-icon"><i class="bi bi-envelope"></i></span> Mailer</a>
            <a href="/vault" class="nav-item"><span class="nav-icon"><i class="bi bi-lock"></i></span> Vault</a>
            <a href="/pm" class="nav-item"><span class="nav-icon"><i class="bi bi-building"></i></span> Property Mgmt</a>
            <a href="/cfo" class="nav-item"><span class="nav-icon"><i class="bi bi-graph-up"></i></span> CFO</a>
            <a href="/danimal" class="nav-item"><span class="nav-icon"><i class="bi bi-database"></i></span> Danimal Data</a>
        </div>
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar"><%= typeof user !== 'undefined' && user && user.first_name ? user.first_name.charAt(0) : 'U' %><%= typeof user !== 'undefined' && user && user.last_name ? user.last_name.charAt(0) : '' %></div>
                <div>
                    <div class="user-name"><%= typeof user !== 'undefined' && user ? (user.first_name || '') + ' ' + (user.last_name || '') : 'User' %></div>
                    <div class="user-role"><%= typeof user !== 'undefined' && user ? user.role : '' %></div>
                </div>
            </div>
            <a href="/auth/logout"><i class="bi bi-box-arrow-left"></i> Sign Out</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <h1><span class="accent">INTEL</span> Marketing Engine</h1>
            <div class="top-bar-actions">
                <button class="btn btn-ghost" onclick="loadStats()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                <a href="/intel/create" class="btn btn-primary"><i class="bi bi-plus-lg"></i> New Project</a>
            </div>
        </div>

        <!-- Sub-Tab Navigation -->
        <div class="intel-tabs">
            <a href="/intel" class="intel-tab active">
                <i class="bi bi-grid-3x3-gap"></i> Overview
            </a>
            <a href="/intel/research" class="intel-tab">
                <i class="bi bi-search"></i> Research
            </a>
            <a href="/intel/create" class="intel-tab">
                <i class="bi bi-brush"></i> Create
            </a>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="stat-projects">-</div>
                <div class="stat-label">Total Projects</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-exports">-</div>
                <div class="stat-label">Exports Generated</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-logos">-</div>
                <div class="stat-label">Logo Catalog</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-shares">-</div>
                <div class="stat-label">LinkedIn Shares</div>
            </div>
        </div>

        <!-- Sub-Function Cards -->
        <div class="subfunc-grid">
            <!-- Research Card -->
            <a href="/intel/research" class="subfunc-card">
                <div class="subfunc-icon research"><i class="bi bi-search"></i></div>
                <div class="subfunc-title">Research</div>
                <div class="subfunc-desc">
                    Enter a property address to pull aerial imagery, identify surrounding tenants,
                    gather demographic data, and retrieve traffic counts. Build the intelligence
                    package that powers your marketing materials.
                </div>
                <div class="subfunc-features">
                    <span class="subfunc-feature">EagleView Aerials</span>
                    <span class="subfunc-feature">Google Places</span>
                    <span class="subfunc-feature">ArcGIS Demographics</span>
                    <span class="subfunc-feature">FDOT Traffic</span>
                    <span class="subfunc-feature">Tenant ID</span>
                </div>
                <div class="subfunc-arrow"><i class="bi bi-arrow-right"></i></div>
            </a>

            <!-- Create Card -->
            <a href="/intel/create" class="subfunc-card">
                <div class="subfunc-icon create"><i class="bi bi-brush"></i></div>
                <div class="subfunc-title">Create</div>
                <div class="subfunc-desc">
                    Design institutional-quality marketing materials using the canvas editor.
                    Upload aerials, drag logos from the catalog, add labels and callouts,
                    then export to PNG/PDF or share directly to LinkedIn.
                </div>
                <div class="subfunc-features">
                    <span class="subfunc-feature">Canvas Editor</span>
                    <span class="subfunc-feature">Logo Catalog</span>
                    <span class="subfunc-feature">PNG/JPG Export</span>
                    <span class="subfunc-feature">LinkedIn Share</span>
                    <span class="subfunc-feature">Templates</span>
                </div>
                <div class="subfunc-arrow"><i class="bi bi-arrow-right"></i></div>
            </a>
        </div>

        <!-- Recent Activity -->
        <div class="section-header">
            <div class="section-title">Recent Activity</div>
            <a href="/intel/create" class="section-action">View All Projects →</a>
        </div>
        <div class="activity-list">
            <div class="activity-empty" id="activity-container">
                <i class="bi bi-folder-plus"></i>
                <h3>No INTEL Projects Yet</h3>
                <p>Create your first project to start building institutional-quality marketing materials.</p>
            </div>
        </div>
    </div>

    <script>
        async function loadStats() {
            try {
                const res = await fetch('/api/intel/stats');
                if (res.ok) {
                    const data = await res.json();
                    document.getElementById('stat-projects').textContent = data.total_projects || 0;
                    document.getElementById('stat-exports').textContent = data.total_exports || 0;
                    document.getElementById('stat-logos').textContent = data.total_logos || 0;
                    document.getElementById('stat-shares').textContent = data.linkedin_shares || 0;
                }
            } catch (e) { console.error('[INTEL] Stats load error:', e); }
        }

        async function loadRecentProjects() {
            try {
                const res = await fetch('/api/intel/projects');
                if (res.ok) {
                    const data = await res.json();
                    if (data.projects && data.projects.length > 0) {
                        const container = document.getElementById('activity-container');
                        container.innerHTML = '';
                        container.style.textAlign = 'left';
                        container.style.padding = '0';
                        container.style.background = 'transparent';
                        container.style.border = 'none';
                        data.projects.slice(0, 5).forEach(p => {
                            const item = document.createElement('div');
                            item.style.cssText = 'background:#1a2332;border:1px solid rgba(255,255,255,0.06);border-radius:10px;padding:16px 20px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;transition:all 0.15s;';
                            item.onmouseover = () => { item.style.borderColor = 'rgba(16,185,129,0.2)'; };
                            item.onmouseout = () => { item.style.borderColor = 'rgba(255,255,255,0.06)'; };
                            item.onclick = () => { window.location.href = '/intel/create?project=' + p.id; };
                            item.innerHTML = '<div><div style="font-weight:600;font-size:0.9rem;color:#e2e8f0;">' + (p.name || 'Untitled') + '</div><div style="font-size:0.75rem;color:#64748b;margin-top:2px;">' + (p.address || 'No address') + ' &middot; ' + (p.page_count || 3) + ' pages</div></div><div style="color:#475569;font-size:0.75rem;">' + new Date(p.updated_at || p.created_at).toLocaleDateString() + '</div>';
                            container.appendChild(item);
                        });
                    }
                }
            } catch (e) { console.error('[INTEL] Projects load error:', e); }
        }

        loadStats();
        loadRecentProjects();
    </script>
</body>
</html>
