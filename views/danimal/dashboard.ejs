<!DOCTYPE html>
<html lang="en" data-theme="<%= typeof theme !== 'undefined' ? theme : 'light' %>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danimal Data Hub - CRE OS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/theme.css">
    <script src="/js/theme.js"></script>
    <style>
        :root {
            --sidebar-width: 250px;
            --primary: #1e3a5f;
            --accent: #10b981;
            --danger: #ef4444;
            --crm-blue: #3b82f6;
            --mail-orange: #f97316;
        }
        body { background: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', system-ui, sans-serif; }

        /* Sidebar */
        .sidebar {
            position: fixed; left: 0; top: 0; bottom: 0;
            width: var(--sidebar-width); background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            padding: 1.5rem; border-right: 1px solid #334155; z-index: 100;
        }
        .sidebar-logo { color: #10b981; font-size: 1.4rem; font-weight: 700; margin-bottom: 2rem; }
        .sidebar-logo i { margin-right: 0.5rem; }
        .sidebar-nav { list-style: none; padding: 0; margin: 0; }
        .sidebar-nav li { margin-bottom: 0.25rem; }
        .sidebar-nav a {
            color: #94a3b8; text-decoration: none; padding: 0.75rem 1rem;
            display: flex; align-items: center; gap: 0.75rem; border-radius: 8px;
            transition: all 0.2s;
        }
        .sidebar-nav a:hover { background: #334155; color: #fff; }
        .sidebar-nav a.active { background: #10b981; color: #fff; }
        .nav-divider { border-top: 1px solid #475569; margin: 1rem 0; }
        .nav-label { color: #64748b; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; padding: 0.5rem 1rem; }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); padding: 2rem; min-height: 100vh; }

        /* Cards */
        .stat-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569; border-radius: 12px; padding: 1.5rem;
        }
        .stat-card h3 { font-size: 2rem; color: #10b981; margin: 0; }
        .stat-card p { color: #94a3b8; margin: 0; font-size: 0.9rem; }

        .card {
            background: #1e293b; border: 1px solid #334155; border-radius: 12px;
        }
        .card-header { background: #0f172a; border-bottom: 1px solid #334155; padding: 1rem 1.5rem; }
        .card-body { padding: 1.5rem; }

        /* Tables */
        .table { color: #e2e8f0; }
        .table thead th { background: #0f172a; border-bottom: 2px solid #334155; color: #94a3b8; font-weight: 600; }
        .table tbody tr { border-bottom: 1px solid #334155; }
        .table tbody tr:hover { background: #334155; }
        .table tbody tr.selected { background: rgba(16, 185, 129, 0.15); }

        /* Badges */
        .badge-active { background: #10b981; }
        .badge-inactive { background: #6b7280; }
        .badge-enriched { background: #8b5cf6; }

        /* Buttons */
        .btn-enrich { background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); border: none; color: white; }
        .btn-enrich:hover { background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%); color: white; }
        .btn-crm { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none; color: white; }
        .btn-crm:hover { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; }
        .btn-campaign { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); border: none; color: white; }
        .btn-campaign:hover { background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%); color: white; }

        /* Progress */
        .enrichment-progress {
            background: #334155; border-radius: 8px; height: 8px; overflow: hidden;
        }
        .enrichment-progress .progress-bar {
            background: linear-gradient(90deg, #10b981, #8b5cf6); transition: width 0.5s;
        }

        /* Filters */
        .filter-section { background: #0f172a; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
        .form-control, .form-select {
            background: #1e293b; border: 1px solid #475569; color: #e2e8f0;
        }
        .form-control:focus, .form-select:focus {
            background: #1e293b; border-color: #10b981; color: #e2e8f0;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }

        /* API Usage Meter */
        .api-meter { background: #0f172a; border-radius: 8px; padding: 1rem; }
        .api-meter-bar { background: #334155; border-radius: 4px; height: 20px; overflow: hidden; }
        .api-meter-fill {
            height: 100%; transition: width 0.3s;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 70%, #ef4444 100%);
        }

        /* Checkbox styling */
        .form-check-input:checked { background-color: #10b981; border-color: #10b981; }
        .lead-checkbox { width: 18px; height: 18px; cursor: pointer; }

        /* Loading spinner */
        .spinner-glow {
            width: 3rem; height: 3rem;
            border: 3px solid #334155;
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Selection toolbar */
        .selection-toolbar {
            position: sticky;
            top: 0;
            z-index: 50;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            display: none;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .selection-toolbar.active { display: flex; }
        .selection-count { 
            background: #10b981; 
            color: white; 
            padding: 0.25rem 0.75rem; 
            border-radius: 100px; 
            font-weight: 600;
        }

        /* Pagination */
        .pagination-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: #0f172a;
            border-top: 1px solid #334155;
        }
        .pagination-controls button {
            background: #334155;
            border: 1px solid #475569;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
        }
        .pagination-controls button:hover { background: #475569; }
        .pagination-controls button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }
        .toast-custom {
            background: #1e293b;
            border: 1px solid #334155;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        .toast-custom.success { border-left: 4px solid #10b981; }
        .toast-custom.error { border-left: 4px solid #ef4444; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-logo">
            <i class="bi bi-database-fill"></i> Danimal Data
        </div>
        <ul class="sidebar-nav">
            <li><a href="/danimal" class="active"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
            <li><a href="/danimal/hub"><i class="bi bi-box"></i> Data Hub</a></li>
            <li><a href="/danimal/leads"><i class="bi bi-people"></i> All Leads</a></li>
            <li><a href="/danimal/import"><i class="bi bi-cloud-download"></i> Import Data</a></li>
            <li><a href="/danimal/enrich"><i class="bi bi-magic"></i> Enrich</a></li>
            <li><a href="/danimal/export"><i class="bi bi-file-earmark-arrow-down"></i> Export</a></li>
            
            <div class="nav-divider"></div>
            <div class="nav-label">Integrations</div>
            <li><a href="/crm"><i class="bi bi-kanban text-primary"></i> CRM Pipeline</a></li>
            <li><a href="/mailer"><i class="bi bi-envelope" style="color: #f97316;"></i> Sunday-Mail</a></li>
            
            <div class="nav-divider"></div>
            <li><a href="/dashboard"><i class="bi bi-arrow-left"></i> Back to Zenith</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h3 mb-1">Danimal Data Hub</h1>
                <p class="text-muted mb-0">Florida Business Intelligence Platform</p>
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-light" onclick="refreshStats()">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
                <button class="btn btn-enrich" onclick="openEnrichModal()">
                    <i class="bi bi-magic"></i> Enrich Leads
                </button>
            </div>
        </div>

        <!-- Stats Row -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <h3 id="totalLeads">--</h3>
                    <p><i class="bi bi-people"></i> Total Leads</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <h3 id="withPhone">--</h3>
                    <p><i class="bi bi-telephone"></i> With Phone</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <h3 id="withEmail">--</h3>
                    <p><i class="bi bi-envelope"></i> With Email</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <h3 id="enrichedCount">--</h3>
                    <p><i class="bi bi-check-circle"></i> Enriched</p>
                </div>
            </div>
        </div>

        <!-- Selection Toolbar (appears when leads selected) -->
        <div class="selection-toolbar" id="selectionToolbar">
            <span class="selection-count"><span id="selectedCount">0</span> selected</span>
            <button class="btn btn-crm" onclick="openPushToCrmModal()">
                <i class="bi bi-kanban"></i> Push to CRM
            </button>
            <button class="btn btn-campaign" onclick="openQuickCampaignModal()">
                <i class="bi bi-envelope"></i> Quick Campaign
            </button>
            <button class="btn btn-outline-light btn-sm" onclick="clearSelection()">
                <i class="bi bi-x"></i> Clear
            </button>
            <div class="ms-auto">
                <button class="btn btn-outline-light btn-sm" onclick="selectAllVisible()">Select All Visible</button>
            </div>
        </div>

        <!-- Filters -->
        <div class="filter-section">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label small text-muted">Industry</label>
                    <select class="form-select" id="filterIndustry" onchange="applyFilters()">
                        <option value="">All Industries</option>
                        <option value="Construction">üèóÔ∏è Construction</option>
                        <option value="Real Estate">üè† Real Estate</option>
                        <option value="Cosmetology">üíá Cosmetology</option>
                        <option value="Food Service">üçΩÔ∏è Food Service</option>
                        <option value="Healthcare">üè• Healthcare</option>
                        <option value="Community Association">üè¢ CAM</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label small text-muted">City</label>
                    <input type="text" class="form-control" id="filterCity" placeholder="e.g., Miami" onchange="applyFilters()">
                </div>
                <div class="col-md-2">
                    <label class="form-label small text-muted">Status</label>
                    <select class="form-select" id="filterStatus" onchange="applyFilters()">
                        <option value="">All Status</option>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label small text-muted">Has Email</label>
                    <select class="form-select" id="filterEmail" onchange="applyFilters()">
                        <option value="">Any</option>
                        <option value="yes">Yes - Has Email</option>
                        <option value="no">No Email</option>
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end gap-2">
                    <button class="btn btn-outline-light flex-grow-1" onclick="applyFilters()">
                        <i class="bi bi-search"></i> Search
                    </button>
                    <button class="btn btn-outline-secondary" onclick="clearFilters()">
                        <i class="bi bi-x-circle"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Leads Table -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-list-ul"></i> Leads <span class="text-muted small" id="resultsCount"></span></h5>
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-crm" onclick="bulkPushWithFilters()">
                        <i class="bi bi-kanban"></i> Bulk Push to CRM
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th style="width: 40px;">
                                    <input type="checkbox" class="form-check-input lead-checkbox" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th>Business Name</th>
                                <th>Industry</th>
                                <th>City</th>
                                <th>Contact</th>
                                <th>Score</th>
                                <th>Status</th>
                                <th style="width: 100px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="leadsTable">
                            <tr>
                                <td colspan="8" class="text-center py-4">
                                    <div class="spinner-glow mx-auto"></div>
                                    <p class="mt-2 mb-0 text-muted">Loading leads...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-controls">
                    <div>
                        <span class="text-muted">Showing <span id="showingFrom">0</span>-<span id="showingTo">0</span> of <span id="totalResults">0</span></span>
                    </div>
                    <div class="d-flex gap-2">
                        <button onclick="prevPage()" id="prevBtn" disabled><i class="bi bi-chevron-left"></i> Previous</button>
                        <button onclick="nextPage()" id="nextBtn">Next <i class="bi bi-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Push to CRM Modal -->
    <div class="modal fade" id="pushCrmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title"><i class="bi bi-kanban text-primary"></i> Push to CRM</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        Push <strong id="pushCount">0</strong> selected leads to your CRM pipeline.
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Pipeline Stage</label>
                        <select class="form-select" id="crmStage">
                            <option value="New">New Lead</option>
                            <option value="Contacted">Contacted</option>
                            <option value="Qualified">Qualified</option>
                            <option value="Proposal">Proposal</option>
                        </select>
                    </div>
                    <div id="pushProgress" class="d-none">
                        <div class="enrichment-progress mb-2">
                            <div class="progress-bar" id="pushProgressBar" style="width: 0%"></div>
                        </div>
                        <p class="text-center mb-0" id="pushStatus">Processing...</p>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-crm" id="confirmPushBtn" onclick="pushToCrm()">
                        <i class="bi bi-arrow-right-circle"></i> Push to CRM
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Campaign Modal -->
    <div class="modal fade" id="quickCampaignModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title"><i class="bi bi-envelope" style="color: #f97316;"></i> Quick Email Campaign</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="bi bi-lightning-fill"></i>
                        Create a campaign directly from Danimal Data - skip the CRM for quick outreach!
                    </div>
                    <div class="row g-3 mb-3">
                        <div class="col-12">
                            <label class="form-label">Campaign Name</label>
                            <input type="text" class="form-control" id="campaignName" placeholder="e.g., Q1 Construction Outreach">
                        </div>
                    </div>
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Email Template</label>
                            <select class="form-select" id="campaignTemplate" onchange="loadTemplatePreview()">
                                <option value="intro">Professional Introduction</option>
                                <option value="renewal">License Renewal Outreach</option>
                                <option value="followup">Follow-up Email</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Recipients</label>
                            <div class="form-control bg-dark" style="padding-top: 0.5rem;">
                                <strong id="campaignRecipients">0</strong> leads with email addresses
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Subject Line</label>
                        <input type="text" class="form-control" id="campaignSubject" value="Introduction from CRE Consultants">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Preview</label>
                        <div class="border border-secondary rounded p-3" style="background: #fff; color: #1e293b; min-height: 150px;" id="emailPreview">
                            <p>Hi {{contact_name}},</p>
                            <p>I noticed that <strong>{{business_name}}</strong> holds a {{license_type}} license...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-campaign" onclick="createQuickCampaign()">
                        <i class="bi bi-send"></i> Create Campaign
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Push Modal -->
    <div class="modal fade" id="bulkPushModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title"><i class="bi bi-kanban text-primary"></i> Bulk Push to CRM</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        Push leads matching your current filters to CRM.
                    </div>
                    <div class="mb-3">
                        <label class="form-label">How many leads?</label>
                        <select class="form-select" id="bulkLimit">
                            <option value="50">50 leads</option>
                            <option value="100" selected>100 leads</option>
                            <option value="250">250 leads</option>
                            <option value="500">500 leads</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Pipeline Stage</label>
                        <select class="form-select" id="bulkStage">
                            <option value="New">New Lead</option>
                            <option value="Contacted">Contacted</option>
                        </select>
                    </div>
                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="bulkEmailOnly" checked>
                        <label class="form-check-label">Only leads with email addresses</label>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-crm" onclick="executeBulkPush()">
                        <i class="bi bi-arrow-right-circle"></i> Push to CRM
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enrich Modal -->
    <div class="modal fade" id="enrichModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title"><i class="bi bi-magic"></i> Enrich Leads with Google Places</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        Enrichment adds phone numbers and websites from Google Places API.
                        <strong>Best results:</strong> Restaurants, Hotels, Salons, Retail stores.
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Industry</label>
                            <select class="form-select" id="enrichIndustry">
                                <option value="">All Industries</option>
                                <option value="Food Service">üçΩÔ∏è Food Service (Best)</option>
                                <option value="Hospitality">üè® Hospitality (Best)</option>
                                <option value="Personal Services">üíá Personal Services (Best)</option>
                                <option value="Real Estate">üè† Real Estate</option>
                                <option value="Healthcare">üè• Healthcare</option>
                                <option value="Construction">üèóÔ∏è Construction</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">City</label>
                            <input type="text" class="form-control" id="enrichCity" placeholder="e.g., Miami, Tampa">
                        </div>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Number of Leads</label>
                            <select class="form-select" id="enrichLimit">
                                <option value="25">25 leads</option>
                                <option value="50" selected>50 leads</option>
                                <option value="100">100 leads</option>
                                <option value="250">250 leads</option>
                                <option value="500">500 leads (use sparingly)</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Source</label>
                            <select class="form-select" id="enrichSource">
                                <option value="">All Sources</option>
                                <option value="DBPR">DBPR</option>
                                <option value="sunbiz">Sunbiz</option>
                            </select>
                        </div>
                    </div>

                    <div id="enrichProgress" class="d-none">
                        <div class="enrichment-progress mb-2">
                            <div class="progress-bar" id="enrichProgressBar" style="width: 0%"></div>
                        </div>
                        <p class="text-center mb-0">
                            <span id="enrichStatus">Starting enrichment...</span>
                        </p>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-enrich" id="startEnrichBtn" onclick="startEnrichment()">
                        <i class="bi bi-play-fill"></i> Start Enrichment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let enrichModal, pushCrmModal, quickCampaignModal, bulkPushModal;
        let currentPage = 1;
        let pageSize = 50;
        let totalResults = 0;
        let selectedLeads = new Set();
        let currentFilters = {};

        document.addEventListener('DOMContentLoaded', () => {
            enrichModal = new bootstrap.Modal(document.getElementById('enrichModal'));
            pushCrmModal = new bootstrap.Modal(document.getElementById('pushCrmModal'));
            quickCampaignModal = new bootstrap.Modal(document.getElementById('quickCampaignModal'));
            bulkPushModal = new bootstrap.Modal(document.getElementById('bulkPushModal'));
            refreshStats();
            loadLeads();
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // STATS & DATA LOADING
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        async function refreshStats() {
            try {
                const res = await fetch('/api/danimal/stats');
                const data = await res.json();

                if (data.success) {
                    const s = data.stats;
                    document.getElementById('totalLeads').textContent = parseInt(s.total_leads).toLocaleString();
                    document.getElementById('withPhone').textContent = parseInt(s.with_phone).toLocaleString();
                    document.getElementById('withEmail').textContent = parseInt(s.with_email || 0).toLocaleString();
                    document.getElementById('enrichedCount').textContent = parseInt(s.enriched).toLocaleString();
                }
            } catch (err) {
                console.error('Failed to load stats:', err);
            }
        }

        async function loadLeads() {
            try {
                const params = new URLSearchParams({
                    limit: pageSize,
                    offset: (currentPage - 1) * pageSize,
                    ...currentFilters
                });
                
                const res = await fetch(`/api/danimal/leads?${params}`);
                const data = await res.json();

                if (data.success && data.leads.length > 0) {
                    totalResults = data.total || data.leads.length;
                    renderLeadsTable(data.leads);
                    updatePagination();
                } else {
                    document.getElementById('leadsTable').innerHTML = `
                        <tr><td colspan="8" class="text-center py-4 text-muted">
                            No leads found matching your criteria. <a href="/danimal/import">Import data</a> to get started.
                        </td></tr>
                    `;
                    totalResults = 0;
                    updatePagination();
                }
            } catch (err) {
                document.getElementById('leadsTable').innerHTML = `
                    <tr><td colspan="8" class="text-center py-4 text-danger">Failed to load leads</td></tr>
                `;
            }
        }

        function renderLeadsTable(leads) {
            const html = leads.map(l => `
                <tr class="${selectedLeads.has(l.id) ? 'selected' : ''}" data-id="${l.id}">
                    <td>
                        <input type="checkbox" class="form-check-input lead-checkbox" 
                            ${selectedLeads.has(l.id) ? 'checked' : ''} 
                            onchange="toggleLeadSelection(${l.id})">
                    </td>
                    <td>
                        <strong>${escapeHtml(l.business_name || '')}</strong>
                        ${l.dba ? `<br><small class="text-muted">DBA: ${escapeHtml(l.dba)}</small>` : ''}
                    </td>
                    <td><span class="badge bg-secondary">${escapeHtml(l.industry || '-')}</span></td>
                    <td>${escapeHtml(l.city || '-')}, ${l.state || 'FL'}</td>
                    <td>
                        ${l.phone ? `<i class="bi bi-telephone-fill text-success"></i> ` : ''}
                        ${l.email ? `<i class="bi bi-envelope-fill text-info"></i>` : ''}
                        ${!l.phone && !l.email ? '<span class="text-muted">-</span>' : ''}
                    </td>
                    <td><span class="badge ${l.lead_score >= 70 ? 'bg-success' : l.lead_score >= 50 ? 'bg-warning' : 'bg-secondary'}">${l.lead_score || 50}</span></td>
                    <td>
                        ${l.enriched_at ? '<span class="badge badge-enriched">Enriched</span>' : ''}
                        <span class="badge ${l.license_status === 'Active' ? 'badge-active' : 'badge-inactive'}">${l.license_status || 'Unknown'}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="pushSingleLead(${l.id})" title="Push to CRM">
                            <i class="bi bi-plus"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
            document.getElementById('leadsTable').innerHTML = html;
        }

        function updatePagination() {
            const from = totalResults > 0 ? (currentPage - 1) * pageSize + 1 : 0;
            const to = Math.min(currentPage * pageSize, totalResults);
            
            document.getElementById('showingFrom').textContent = from;
            document.getElementById('showingTo').textContent = to;
            document.getElementById('totalResults').textContent = totalResults.toLocaleString();
            document.getElementById('resultsCount').textContent = `(${totalResults.toLocaleString()} total)`;
            
            document.getElementById('prevBtn').disabled = currentPage <= 1;
            document.getElementById('nextBtn').disabled = currentPage * pageSize >= totalResults;
        }

        function nextPage() {
            if (currentPage * pageSize < totalResults) {
                currentPage++;
                loadLeads();
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                loadLeads();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SELECTION HANDLING
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function toggleLeadSelection(id) {
            if (selectedLeads.has(id)) {
                selectedLeads.delete(id);
            } else {
                selectedLeads.add(id);
            }
            updateSelectionUI();
        }

        function toggleSelectAll() {
            const checkAll = document.getElementById('selectAll').checked;
            document.querySelectorAll('#leadsTable .lead-checkbox').forEach(cb => {
                const id = parseInt(cb.closest('tr').dataset.id);
                if (checkAll) {
                    selectedLeads.add(id);
                } else {
                    selectedLeads.delete(id);
                }
                cb.checked = checkAll;
            });
            updateSelectionUI();
        }

        function selectAllVisible() {
            document.querySelectorAll('#leadsTable .lead-checkbox').forEach(cb => {
                const id = parseInt(cb.closest('tr').dataset.id);
                selectedLeads.add(id);
                cb.checked = true;
            });
            updateSelectionUI();
        }

        function clearSelection() {
            selectedLeads.clear();
            document.querySelectorAll('.lead-checkbox').forEach(cb => cb.checked = false);
            updateSelectionUI();
        }

        function updateSelectionUI() {
            const count = selectedLeads.size;
            document.getElementById('selectedCount').textContent = count;
            document.getElementById('selectionToolbar').classList.toggle('active', count > 0);
            
            // Update row highlighting
            document.querySelectorAll('#leadsTable tr').forEach(tr => {
                const id = parseInt(tr.dataset.id);
                tr.classList.toggle('selected', selectedLeads.has(id));
            });
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // FILTERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function applyFilters() {
            currentFilters = {};
            
            const industry = document.getElementById('filterIndustry').value;
            const city = document.getElementById('filterCity').value;
            const status = document.getElementById('filterStatus').value;
            const email = document.getElementById('filterEmail').value;
            
            if (industry) currentFilters.industry = industry;
            if (city) currentFilters.city = city;
            if (status) currentFilters.license_status = status;
            if (email === 'yes') currentFilters.hasEmail = 'true';
            
            currentPage = 1;
            loadLeads();
        }

        function clearFilters() {
            document.getElementById('filterIndustry').value = '';
            document.getElementById('filterCity').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterEmail').value = '';
            currentFilters = {};
            currentPage = 1;
            loadLeads();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // PUSH TO CRM
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function openPushToCrmModal() {
            document.getElementById('pushCount').textContent = selectedLeads.size;
            document.getElementById('pushProgress').classList.add('d-none');
            document.getElementById('confirmPushBtn').disabled = false;
            pushCrmModal.show();
        }

        async function pushToCrm() {
            const stage = document.getElementById('crmStage').value;
            const leadIds = Array.from(selectedLeads);
            
            document.getElementById('confirmPushBtn').disabled = true;
            document.getElementById('pushProgress').classList.remove('d-none');
            document.getElementById('pushStatus').textContent = 'Processing...';
            
            try {
                const res = await fetch('/api/danimal/push-to-crm', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ leadIds, stage })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('pushProgressBar').style.width = '100%';
                    document.getElementById('pushStatus').textContent = data.message;
                    showToast(data.message, 'success');
                    clearSelection();
                    setTimeout(() => pushCrmModal.hide(), 1500);
                } else {
                    document.getElementById('pushStatus').textContent = 'Error: ' + data.error;
                    showToast('Failed: ' + data.error, 'error');
                }
            } catch (err) {
                document.getElementById('pushStatus').textContent = 'Error: ' + err.message;
                showToast('Error: ' + err.message, 'error');
            }
            
            document.getElementById('confirmPushBtn').disabled = false;
        }

        async function pushSingleLead(id) {
            try {
                const res = await fetch('/api/danimal/push-to-crm', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ leadIds: [id], stage: 'New' })
                });
                
                const data = await res.json();
                showToast(data.message || (data.success ? 'Added to CRM!' : 'Failed'), data.success ? 'success' : 'error');
            } catch (err) {
                showToast('Error: ' + err.message, 'error');
            }
        }

        function bulkPushWithFilters() {
            bulkPushModal.show();
        }

        async function executeBulkPush() {
            const limit = parseInt(document.getElementById('bulkLimit').value);
            const stage = document.getElementById('bulkStage').value;
            const emailOnly = document.getElementById('bulkEmailOnly').checked;
            
            const filters = { ...currentFilters };
            if (emailOnly) filters.hasEmail = 'true';
            
            try {
                const res = await fetch('/api/danimal/bulk-push', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filters, limit, stage })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showToast(`Added ${data.inserted} leads to CRM (${data.skipped} already existed)`, 'success');
                    bulkPushModal.hide();
                } else {
                    showToast('Failed: ' + data.error, 'error');
                }
            } catch (err) {
                showToast('Error: ' + err.message, 'error');
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // QUICK CAMPAIGN
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function openQuickCampaignModal() {
            // Count leads with email
            const withEmail = Array.from(selectedLeads).length; // Simplified - would need API call for accurate count
            document.getElementById('campaignRecipients').textContent = withEmail;
            quickCampaignModal.show();
        }

        async function createQuickCampaign() {
            const name = document.getElementById('campaignName').value;
            const subject = document.getElementById('campaignSubject').value;
            
            if (!name) {
                showToast('Please enter a campaign name', 'error');
                return;
            }
            
            const filters = { ...currentFilters };
            filters.hasEmail = 'true';
            
            try {
                const res = await fetch('/api/sunday-mail/quick-campaign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        campaignName: name,
                        filters,
                        limit: selectedLeads.size || 100,
                        templateSubject: subject,
                        templateHtml: document.getElementById('emailPreview').innerHTML
                    })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showToast(`Campaign created with ${data.recipientCount} recipients!`, 'success');
                    quickCampaignModal.hide();
                    clearSelection();
                } else {
                    showToast('Failed: ' + data.error, 'error');
                }
            } catch (err) {
                showToast('Error: ' + err.message, 'error');
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ENRICHMENT
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function openEnrichModal() {
            document.getElementById('enrichProgress').classList.add('d-none');
            document.getElementById('startEnrichBtn').disabled = false;
            enrichModal.show();
        }

        async function startEnrichment() {
            const industry = document.getElementById('enrichIndustry').value;
            const city = document.getElementById('enrichCity').value;
            const limit = document.getElementById('enrichLimit').value;
            const source = document.getElementById('enrichSource').value;

            document.getElementById('startEnrichBtn').disabled = true;
            document.getElementById('enrichProgress').classList.remove('d-none');
            document.getElementById('enrichStatus').textContent = 'Starting enrichment...';
            document.getElementById('enrichProgressBar').style.width = '0%';

            try {
                const res = await fetch('/api/danimal/enrich', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        filters: { industry, city, source },
                        limit: parseInt(limit)
                    })
                });

                const data = await res.json();

                if (data.success && data.jobId) {
                    pollEnrichmentStatus(data.jobId);
                } else {
                    document.getElementById('enrichStatus').textContent = data.message || data.error || 'Failed to start';
                    document.getElementById('startEnrichBtn').disabled = false;
                }
            } catch (err) {
                document.getElementById('enrichStatus').textContent = 'Error: ' + err.message;
                document.getElementById('startEnrichBtn').disabled = false;
            }
        }

        async function pollEnrichmentStatus(jobId) {
            try {
                const res = await fetch(`/api/danimal/enrich/status/${jobId}`);
                const data = await res.json();

                if (data.success && data.job) {
                    const job = data.job;
                    const pct = (job.processed / job.total) * 100;
                    document.getElementById('enrichProgressBar').style.width = pct + '%';
                    document.getElementById('enrichStatus').textContent =
                        `Processing: ${job.processed}/${job.total} | Enriched: ${job.enriched} | Not Found: ${job.notFound}`;

                    if (job.status === 'completed') {
                        document.getElementById('enrichStatus').textContent =
                            `‚úì Complete! Enriched: ${job.enriched} | Not Found: ${job.notFound}`;
                        document.getElementById('startEnrichBtn').disabled = false;
                        refreshStats();
                        loadLeads();
                    } else {
                        setTimeout(() => pollEnrichmentStatus(jobId), 1000);
                    }
                }
            } catch (err) {
                console.error('Poll error:', err);
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UTILITIES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast-custom ${type}`;
            toast.innerHTML = `
                <i class="bi bi-${type === 'success' ? 'check-circle text-success' : 'exclamation-circle text-danger'}"></i>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }
    </script>
</body>
</html>
